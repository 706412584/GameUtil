# åä½œå¼Šæ¨¡å—æ¶æ„è®¾è®¡æ–‡æ¡£

## ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ£€æµ‹åŸç†](#æ£€æµ‹åŸç†)
5. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
6. [å®‰å…¨åŠ å›º](#å®‰å…¨åŠ å›º)
7. [æ‰©å±•æŒ‡å—](#æ‰©å±•æŒ‡å—)

---

## ç³»ç»Ÿæ¦‚è¿°

### è®¾è®¡ç›®æ ‡

åä½œå¼Šæ¨¡å—æ—¨åœ¨ä¸º Android åº”ç”¨æä¾›å…¨é¢çš„å®‰å…¨ä¿æŠ¤ï¼Œæ£€æµ‹å’Œé˜²æ­¢å¸¸è§çš„ç ´è§£ã€ä½œå¼Šå’Œç¯¡æ”¹è¡Œä¸ºã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **å…¨é¢æ£€æµ‹** - è¦†ç›–10ç§å¸¸è§å¨èƒç±»å‹
- âœ… **åˆ†çº§å“åº”** - æ ¹æ®é£é™©ç­‰çº§çµæ´»å¤„ç†
- âœ… **å®æ—¶ç›‘æ§** - æ”¯æŒå¼‚æ­¥æ£€æµ‹å’Œå®æ—¶å›è°ƒ
- âœ… **æ€§èƒ½ä¼˜åŒ–** - åå°æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
- âœ… **å¯æ‰©å±•æ€§** - æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•

### å¨èƒç±»å‹

| ç±»å‹ | é£é™©ç­‰çº§ | æè¿° |
|-----|---------|------|
| Root | 5 | è®¾å¤‡å·²è·å–Rootæƒé™ |
| Hookæ¡†æ¶ | 5 | æ£€æµ‹åˆ°Xposed/Fridaç­‰ |
| å†…å­˜ä¿®æ”¹å™¨ | 5 | æ£€æµ‹åˆ°GameGuardianç­‰ |
| ç­¾åå¼‚å¸¸ | 5 | åº”ç”¨è¢«é‡æ–°æ‰“åŒ… |
| å¤šå¼€ | 4 | è™šæ‹Ÿç¯å¢ƒ/å¤šå¼€åº”ç”¨ |
| è°ƒè¯•å™¨ | 4 | åº”ç”¨æ­£åœ¨è¢«è°ƒè¯• |
| æ¨¡æ‹Ÿå™¨ | 3 | è¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸­ |
| æ—¶é—´ä½œå¼Š | 3 | ç³»ç»Ÿæ—¶é—´è¢«ä¿®æ”¹ |
| ä»£ç† | 2 | ç½‘ç»œä»£ç†è®¾ç½® |

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           IntegratedSecurityExample               â”‚  â”‚
â”‚  â”‚  (é›†æˆç¤ºä¾‹ï¼šå®‰å…¨æ£€æµ‹ + å­˜æ¡£ç®¡ç†)                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ ¸å¿ƒå±‚ (SecurityDetector)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â€¢ performSecurityCheck()   - æ‰§è¡Œå®Œæ•´æ£€æµ‹        â”‚  â”‚
â”‚  â”‚  â€¢ getSecurityScore()       - è·å–å®‰å…¨åˆ†æ•°        â”‚  â”‚
â”‚  â”‚  â€¢ generateSecurityReport() - ç”Ÿæˆæ£€æµ‹æŠ¥å‘Š        â”‚  â”‚
â”‚  â”‚  â€¢ SecurityCallback         - å¼‚æ­¥å›è°ƒæ¥å£        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                æ£€æµ‹å±‚ (Detection Modules)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Root   â”‚Emulator â”‚  Hook   â”‚ Debug   â”‚Signatureâ”‚  â”‚
â”‚  â”‚Detector â”‚Detector â”‚Detector â”‚Detector â”‚Validatorâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  Proxy  â”‚ Multi   â”‚ Memory  â”‚  Time   â”‚            â”‚
â”‚  â”‚Detector â”‚Instance â”‚  Hack   â”‚ Cheat   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç³»ç»Ÿå±‚ (Android System APIs)                â”‚
â”‚  â€¢ PackageManager  â€¢ Build  â€¢ Debug  â€¢ Process         â”‚
â”‚  â€¢ /proc æ–‡ä»¶ç³»ç»Ÿ  â€¢ åå°„   â€¢ JNI    â€¢ æ–‡ä»¶æ£€æŸ¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—èŒè´£

#### 1. SecurityDetectorï¼ˆæ ¸å¿ƒåè°ƒå™¨ï¼‰

**èŒè´£ï¼š**
- ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ£€æµ‹å™¨
- åè°ƒæ£€æµ‹æµç¨‹
- æ±‡æ€»æ£€æµ‹ç»“æœ
- è®¡ç®—å®‰å…¨åˆ†æ•°
- è§¦å‘å›è°ƒ

**å…³é”®æ–¹æ³•ï¼š**
```java
public void performSecurityCheck()
public int getSecurityScore()
public String generateSecurityReport()
public Map<String, DetectionResult> getResults()
```

#### 2. å„æ£€æµ‹å™¨ï¼ˆç‹¬ç«‹æ¨¡å—ï¼‰

æ¯ä¸ªæ£€æµ‹å™¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œéµå¾ªç›¸åŒçš„æ¥å£æ¨¡å¼ï¼š

```java
// æ£€æµ‹æ–¹æ³•
public boolean isXxxDetected()

// è·å–è¯¦æƒ…
public String getXxxDetails()

// å†…éƒ¨æˆå‘˜
private List<String> detectedMethods
```

---

## æ ¸å¿ƒç»„ä»¶

### 1. RootDetectorï¼ˆRootæ£€æµ‹å™¨ï¼‰

**æ£€æµ‹ç­–ç•¥ï¼š**

```
æ£€æµ‹æµç¨‹
  â”œâ”€â”€ æ–‡ä»¶æ£€æµ‹
  â”‚   â”œâ”€â”€ æ£€æŸ¥suå‘½ä»¤è·¯å¾„ (/system/bin/su, /system/xbin/su...)
  â”‚   â”œâ”€â”€ æ£€æŸ¥BusyBox
  â”‚   â””â”€â”€ æ£€æŸ¥Rootéšè—å·¥å…·æ–‡ä»¶
  â”‚
  â”œâ”€â”€ åº”ç”¨æ£€æµ‹
  â”‚   â”œâ”€â”€ æ£€æµ‹SuperSU
  â”‚   â”œâ”€â”€ æ£€æµ‹Magisk
  â”‚   â”œâ”€â”€ æ£€æµ‹KernelSU
  â”‚   â””â”€â”€ æ£€æµ‹Rootéšè—åº”ç”¨
  â”‚
  â”œâ”€â”€ ç³»ç»Ÿå±æ€§æ£€æµ‹
  â”‚   â”œâ”€â”€ æ£€æŸ¥Build.TAGS (test-keys)
  â”‚   â”œâ”€â”€ æ£€æŸ¥ro.debuggable
  â”‚   â””â”€â”€ æ£€æŸ¥ro.secure
  â”‚
  â””â”€â”€ æƒé™æ£€æµ‹
      â””â”€â”€ æ£€æŸ¥ç³»ç»Ÿç›®å½•å†™æƒé™
```

**ä»£ç ç¤ºä¾‹ï¼š**
```java
// æ£€æŸ¥suæ–‡ä»¶
for (String path : SU_PATHS) {
    if (new File(path).exists()) {
        detectedMethods.add("æ£€æµ‹åˆ°suæ–‡ä»¶: " + path);
        return true;
    }
}

// æ£€æŸ¥Rootåº”ç”¨
for (String packageName : ROOT_APPS) {
    try {
        context.getPackageManager().getPackageInfo(packageName, 0);
        detectedMethods.add("æ£€æµ‹åˆ°Rootåº”ç”¨: " + packageName);
        return true;
    } catch (Exception ignored) {}
}
```

### 2. EmulatorDetectorï¼ˆæ¨¡æ‹Ÿå™¨æ£€æµ‹å™¨ï¼‰

**æ£€æµ‹ç­–ç•¥ï¼š**

```
æ£€æµ‹æµç¨‹
  â”œâ”€â”€ Buildä¿¡æ¯æ£€æµ‹
  â”‚   â”œâ”€â”€ Build.MODEL (åŒ…å«"Emulator", "SDK"ç­‰)
  â”‚   â”œâ”€â”€ Build.MANUFACTURER (Genymotionç­‰)
  â”‚   â”œâ”€â”€ Build.HARDWARE (goldfish, vbox86ç­‰)
  â”‚   â””â”€â”€ Build.PRODUCT (google_sdkç­‰)
  â”‚
  â”œâ”€â”€ ç¡¬ä»¶ç‰¹å¾æ£€æµ‹
  â”‚   â”œâ”€â”€ CPUæ¶æ„ (x86é€šå¸¸æ˜¯æ¨¡æ‹Ÿå™¨)
  â”‚   â”œâ”€â”€ è¿è¥å•†åç§° ("android"å¼‚å¸¸)
  â”‚   â””â”€â”€ IMEI/è®¾å¤‡IDå¼‚å¸¸
  â”‚
  â”œâ”€â”€ æ–‡ä»¶ç‰¹å¾æ£€æµ‹
  â”‚   â”œâ”€â”€ /dev/socket/qemud (QEMU)
  â”‚   â”œâ”€â”€ /dev/qemu_pipe
  â”‚   â””â”€â”€ Genymotionç‰¹å¾æ–‡ä»¶
  â”‚
  â””â”€â”€ å†…å­˜ç‰¹å¾æ£€æµ‹
      â””â”€â”€ /proc/self/maps (æ£€æŸ¥qemu/vboxç‰¹å¾)
```

### 3. HookDetectorï¼ˆHookæ¡†æ¶æ£€æµ‹å™¨ï¼‰

**æ£€æµ‹ç­–ç•¥ï¼š**

```
æ£€æµ‹æµç¨‹
  â”œâ”€â”€ Xposedæ£€æµ‹
  â”‚   â”œâ”€â”€ æ£€æµ‹XposedåŒ…å
  â”‚   â”œâ”€â”€ æ£€æµ‹XposedBridge.jar
  â”‚   â”œâ”€â”€ æ£€æµ‹libxposed_art.so
  â”‚   â”œâ”€â”€ å †æ ˆæ£€æµ‹
  â”‚   â””â”€â”€ ClassLoaderæ£€æµ‹
  â”‚
  â”œâ”€â”€ Fridaæ£€æµ‹
  â”‚   â”œâ”€â”€ æ£€æµ‹frida-agentåº“
  â”‚   â”œâ”€â”€ æ£€æµ‹frida-server
  â”‚   â”œâ”€â”€ æ£€æµ‹27042ç«¯å£
  â”‚   â”œâ”€â”€ æ£€æµ‹/proc/mapsä¸­çš„frida
  â”‚   â””â”€â”€ æ£€æµ‹gum-js-loopçº¿ç¨‹
  â”‚
  â”œâ”€â”€ Substrateæ£€æµ‹
  â”‚   â”œâ”€â”€ æ£€æµ‹com.saurik.substrateç±»
  â”‚   â”œâ”€â”€ æ£€æµ‹libsubstrate.so
  â”‚   â””â”€â”€ å †æ ˆæ£€æµ‹
  â”‚
  â””â”€â”€ VirtualXposedæ£€æµ‹
      â””â”€â”€ æ£€æµ‹æ•°æ®è·¯å¾„å¼‚å¸¸
```

**å…³é”®ä»£ç ï¼š**
```java
// å †æ ˆæ£€æµ‹Xposed
try {
    throw new Exception("æ£€æµ‹");
} catch (Exception e) {
    for (StackTraceElement element : e.getStackTrace()) {
        if (element.getClassName().contains("de.robv.android.xposed")) {
            return true;
        }
    }
}

// æ£€æµ‹Fridaç«¯å£
BufferedReader reader = new BufferedReader(new FileReader("/proc/net/tcp"));
while ((line = reader.readLine()) != null) {
    if (line.contains(":69CA")) { // 27042 = 0x69CA
        return true;
    }
}
```

### 4. MemoryHackDetectorï¼ˆå†…å­˜ä¿®æ”¹å™¨æ£€æµ‹å™¨ï¼‰

**æ£€æµ‹ç­–ç•¥ï¼š**

```
æ£€æµ‹æµç¨‹
  â”œâ”€â”€ åº”ç”¨æ£€æµ‹
  â”‚   â”œâ”€â”€ GameGuardian (catch_.me_.if_.you_.can_)
  â”‚   â”œâ”€â”€ Cheat Engine
  â”‚   â”œâ”€â”€ GameKiller
  â”‚   â””â”€â”€ å…¶ä»–ä½œå¼Šå·¥å…·
  â”‚
  â”œâ”€â”€ æ–‡ä»¶æ£€æµ‹
  â”‚   â”œâ”€â”€ /sdcard/GameGuardian
  â”‚   â””â”€â”€ /sdcard/ggsaves
  â”‚
  â”œâ”€â”€ å†…å­˜æ£€æµ‹
  â”‚   â”œâ”€â”€ /proc/self/maps (æ£€æŸ¥å¼‚å¸¸åº“)
  â”‚   â”œâ”€â”€ TracerPid (æ˜¯å¦è¢«é™„åŠ )
  â”‚   â””â”€â”€ åŒ¿åå†…å­˜æ˜ å°„æ•°é‡
  â”‚
  â””â”€â”€ è¿›ç¨‹æ£€æµ‹
      â””â”€â”€ æ£€æµ‹å¯ç–‘è·Ÿè¸ªè¿›ç¨‹
```

### 5. TimeCheatDetectorï¼ˆæ—¶é—´ä½œå¼Šæ£€æµ‹å™¨ï¼‰

**æ£€æµ‹ç­–ç•¥ï¼š**

```
æ£€æµ‹æµç¨‹
  â”œâ”€â”€ ç³»ç»Ÿæ—¶é—´è·³è·ƒæ£€æµ‹
  â”‚   â”œâ”€â”€ System.currentTimeMillis()
  â”‚   â”œâ”€â”€ SystemClock.elapsedRealtime()
  â”‚   â””â”€â”€ æ¯”è¾ƒä¸¤è€…å·®å¼‚
  â”‚
  â”œâ”€â”€ å¯åŠ¨æ—¶é—´æ£€æµ‹
  â”‚   â”œâ”€â”€ è®¡ç®—bootTime = currentTime - elapsedRealtime
  â”‚   â”œâ”€â”€ ä¸ä¸Šæ¬¡ä¿å­˜çš„bootTimeå¯¹æ¯”
  â”‚   â””â”€â”€ æ£€æµ‹å¼‚å¸¸è·³è·ƒ
  â”‚
  â””â”€â”€ æœåŠ¡å™¨æ—¶é—´åŒæ­¥
      â”œâ”€â”€ è®°å½•æœåŠ¡å™¨æ—¶é—´
      â”œâ”€â”€ æ ¹æ®elapsedRealtimeè®¡ç®—æœŸæœ›æ—¶é—´
      â””â”€â”€ ä¸å½“å‰ç³»ç»Ÿæ—¶é—´å¯¹æ¯”
```

**å…³é”®ä»£ç ï¼š**
```java
// æ—¶é—´è·³è·ƒæ£€æµ‹
long currentTime = System.currentTimeMillis();
long elapsedRealtime = SystemClock.elapsedRealtime();

if (lastLocalTime > 0) {
    long timeDiff = currentTime - lastLocalTime;
    long realtimeDiff = elapsedRealtime - lastElapsedRealtime;
    
    // å¦‚æœå·®å¼‚è¿‡å¤§ï¼Œè¯´æ˜æ—¶é—´è¢«ä¿®æ”¹
    if (Math.abs(timeDiff - realtimeDiff) > ALLOWED_TIME_DIFF) {
        return true;
    }
}
```

---

## æ£€æµ‹åŸç†

### åŸç†1ï¼šæ–‡ä»¶ç³»ç»Ÿæ£€æµ‹

**æ–¹æ³•ï¼š** æ£€æŸ¥ç‰¹å®šè·¯å¾„æ˜¯å¦å­˜åœ¨æ–‡ä»¶/ç›®å½•

**ç¤ºä¾‹ï¼š**
```java
// Rootæ£€æµ‹ï¼šæŸ¥æ‰¾suå‘½ä»¤
String[] paths = {"/system/bin/su", "/system/xbin/su", "/sbin/su"};
for (String path : paths) {
    if (new File(path).exists()) {
        return true;
    }
}

// Xposedæ£€æµ‹ï¼šæŸ¥æ‰¾ç‰¹å¾æ–‡ä»¶
if (new File("/system/framework/XposedBridge.jar").exists()) {
    return true;
}
```

### åŸç†2ï¼šè¿›ç¨‹ä¿¡æ¯æ£€æµ‹

**æ–¹æ³•ï¼š** è¯»å– /proc æ–‡ä»¶ç³»ç»Ÿè·å–è¿›ç¨‹ä¿¡æ¯

**ç¤ºä¾‹ï¼š**
```java
// æ£€æµ‹TracerPid
BufferedReader reader = new BufferedReader(
    new FileReader("/proc/self/status"));

while ((line = reader.readLine()) != null) {
    if (line.startsWith("TracerPid:")) {
        int pid = Integer.parseInt(line.split(":")[1].trim());
        if (pid != 0) {
            return true; // è¢«è°ƒè¯•
        }
    }
}

// æ£€æµ‹å†…å­˜æ˜ å°„
reader = new BufferedReader(new FileReader("/proc/self/maps"));
while ((line = reader.readLine()) != null) {
    if (line.contains("frida") || line.contains("xposed")) {
        return true;
    }
}
```

### åŸç†3ï¼šBuildä¿¡æ¯æ£€æµ‹

**æ–¹æ³•ï¼š** æ£€æŸ¥ android.os.Build ç±»çš„é™æ€å­—æ®µ

**ç¤ºä¾‹ï¼š**
```java
// æ¨¡æ‹Ÿå™¨æ£€æµ‹
if (Build.FINGERPRINT.startsWith("generic")
    || Build.MODEL.contains("Emulator")
    || Build.MANUFACTURER.contains("Genymotion")
    || Build.HARDWARE.equals("goldfish")) {
    return true;
}

// Rootæ£€æµ‹
if (Build.TAGS != null && Build.TAGS.contains("test-keys")) {
    return true;
}
```

### åŸç†4ï¼šPackageManageræ£€æµ‹

**æ–¹æ³•ï¼š** æŸ¥è¯¢å·²å®‰è£…çš„åº”ç”¨åŒ…

**ç¤ºä¾‹ï¼š**
```java
// æ£€æµ‹Rootç®¡ç†åº”ç”¨
String[] packages = {"com.topjohnwu.magisk", "eu.chainfire.supersu"};
for (String pkg : packages) {
    try {
        context.getPackageManager().getPackageInfo(pkg, 0);
        return true; // å®‰è£…äº†Rootåº”ç”¨
    } catch (PackageManager.NameNotFoundException e) {
        // æœªå®‰è£…
    }
}
```

### åŸç†5ï¼šå¼‚å¸¸å †æ ˆæ£€æµ‹

**æ–¹æ³•ï¼š** ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸å¹¶åˆ†æå †æ ˆ

**ç¤ºä¾‹ï¼š**
```java
// æ£€æµ‹Xposed
try {
    throw new Exception();
} catch (Exception e) {
    for (StackTraceElement element : e.getStackTrace()) {
        String className = element.getClassName();
        if (className.contains("de.robv.android.xposed")
            || className.contains("com.saurik.substrate")) {
            return true;
        }
    }
}
```

### åŸç†6ï¼šç³»ç»Ÿå±æ€§æ£€æµ‹

**æ–¹æ³•ï¼š** é€šè¿‡åå°„è·å–ç³»ç»Ÿå±æ€§

**ç¤ºä¾‹ï¼š**
```java
// è·å–ç³»ç»Ÿå±æ€§
Class<?> c = Class.forName("android.os.SystemProperties");
Method get = c.getMethod("get", String.class);
String value = (String) get.invoke(c, "ro.debuggable");

if ("1".equals(value)) {
    return true; // å¯è°ƒè¯•
}
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. å¼‚æ­¥æ‰§è¡Œ

æ‰€æœ‰æ£€æµ‹éƒ½åœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼š

```java
public void performSecurityCheck() {
    new Thread(() -> {
        // æ‰§è¡Œå„é¡¹æ£€æµ‹
        checkRoot();
        checkEmulator();
        // ...
        
        // å›è°ƒç»“æœ
        summarizeResults();
    }).start();
}
```

### 2. å»¶è¿ŸåŠ è½½

æ£€æµ‹å™¨é‡‡ç”¨æ‡’åŠ è½½æ¨¡å¼ï¼š

```java
private RootDetector rootDetector;

private RootDetector getRootDetector() {
    if (rootDetector == null) {
        rootDetector = new RootDetector(context);
    }
    return rootDetector;
}
```

### 3. ç¼“å­˜ç»“æœ

å¯¹äºè€—æ—¶çš„æ£€æµ‹ï¼Œå¯ä»¥ç¼“å­˜ç»“æœï¼š

```java
private static boolean cachedRootResult = false;
private static long lastCheckTime = 0;
private static final long CACHE_DURATION = 5 * 60 * 1000; // 5åˆ†é’Ÿ

public boolean isDeviceRooted() {
    long now = System.currentTimeMillis();
    if (now - lastCheckTime < CACHE_DURATION) {
        return cachedRootResult;
    }
    
    cachedRootResult = performRootCheck();
    lastCheckTime = now;
    return cachedRootResult;
}
```

### 4. æ€§èƒ½ç»Ÿè®¡

| æ£€æµ‹ç±»å‹ | å¹³å‡è€—æ—¶ | è¯´æ˜ |
|---------|---------|------|
| Rootæ£€æµ‹ | 10-30ms | æ–‡ä»¶IOå¯†é›† |
| æ¨¡æ‹Ÿå™¨æ£€æµ‹ | 20-50ms | åŒ…å«è¿›ç¨‹è¯»å– |
| Hookæ£€æµ‹ | 30-80ms | å †æ ˆåˆ†æè¾ƒæ…¢ |
| è°ƒè¯•å™¨æ£€æµ‹ | 5-15ms | ç³»ç»ŸAPIè°ƒç”¨ |
| ç­¾åéªŒè¯ | 10-30ms | è¯ä¹¦è§£æ |
| å…¶ä»–æ£€æµ‹ | 5-20ms | - |
| **å®Œæ•´æ£€æµ‹** | **100-300ms** | å¹¶å‘æ‰§è¡Œ |

---

## å®‰å…¨åŠ å›º

### 1. ä»£ç æ··æ·†

**proguard-rules.pro:**
```proguard
# ä¿ç•™æ¥å£
-keep public class game.app.anticheat.SecurityDetector {
    public *;
}

# æ··æ·†æ£€æµ‹å™¨
-keep class game.app.anticheat.**Detector { *; }
-obfuscate
-optimizations !code/allocation/variable

# å­—ç¬¦ä¸²åŠ å¯†
-adaptresourcefilecontents
```

### 2. é˜²æ­¢åå°„æ”»å‡»

```java
// æ£€æŸ¥è°ƒç”¨è€…
private void checkCaller() {
    StackTraceElement[] stack = Thread.currentThread().getStackTrace();
    if (stack.length > 3) {
        String caller = stack[3].getClassName();
        if (!caller.startsWith("game.app.anticheat")) {
            throw new SecurityException("Unauthorized access");
        }
    }
}
```

### 3. JNIå±‚å®ç°

å…³é”®æ£€æµ‹é€»è¾‘å¯ä»¥ç”¨Nativeä»£ç å®ç°ï¼š

```c
// native-lib.cpp
JNIEXPORT jboolean JNICALL
Java_game_app_anticheat_RootDetector_nativeCheckRoot(
    JNIEnv* env, jobject obj) {
    
    // Cå±‚æ£€æµ‹ï¼Œæ›´éš¾è¢«Hook
    return access("/system/bin/su", F_OK) == 0;
}
```

### 4. å¤šé‡éªŒè¯

```java
// ç»„åˆå¤šä¸ªæ£€æµ‹æ–¹æ³•
public boolean isRootedWithConfidence() {
    int score = 0;
    
    if (checkSuExists()) score++;
    if (checkRootApps()) score++;
    if (checkBusyBox()) score++;
    if (checkRWPaths()) score++;
    
    // éœ€è¦å¤šä¸ªè¯æ®æ‰ç¡®è®¤
    return score >= 2;
}
```

---

## æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°æ£€æµ‹å™¨

#### æ­¥éª¤1ï¼šåˆ›å»ºæ£€æµ‹å™¨ç±»

```java
public class NewThreatDetector {
    private final Context context;
    private final List<String> detectedMethods = new ArrayList<>();
    
    public NewThreatDetector(Context context) {
        this.context = context.getApplicationContext();
    }
    
    public boolean detectNewThreat() {
        detectedMethods.clear();
        
        // å®ç°æ£€æµ‹é€»è¾‘
        if (checkMethod1()) return true;
        if (checkMethod2()) return true;
        
        return false;
    }
    
    public String getDetails() {
        if (detectedMethods.isEmpty()) {
            return "æœªæ£€æµ‹åˆ°æ–°å¨èƒ";
        }
        return String.join("; ", detectedMethods);
    }
    
    private boolean checkMethod1() {
        // æ£€æµ‹é€»è¾‘1
        return false;
    }
    
    private boolean checkMethod2() {
        // æ£€æµ‹é€»è¾‘2
        return false;
    }
}
```

#### æ­¥éª¤2ï¼šé›†æˆåˆ°SecurityDetector

```java
public class SecurityDetector {
    private final NewThreatDetector newThreatDetector;
    
    public SecurityDetector(Context context, SecurityCallback callback) {
        // ...
        this.newThreatDetector = new NewThreatDetector(context);
    }
    
    public void performSecurityCheck() {
        new Thread(() -> {
            // ...
            checkNewThreat();
            // ...
        }).start();
    }
    
    private void checkNewThreat() {
        boolean detected = newThreatDetector.detectNewThreat();
        String details = newThreatDetector.getDetails();
        
        DetectionResult result = new DetectionResult(
            "NEW_THREAT",
            "æ–°å¨èƒæ£€æµ‹",
            detected ? 4 : 0,  // é£é™©ç­‰çº§
            detected,
            details
        );
        
        results.put("NEW_THREAT", result);
        
        if (detected && callback != null) {
            callback.onThreatDetected("NEW_THREAT", "æ£€æµ‹åˆ°æ–°å¨èƒ", 4);
        }
    }
}
```

### è‡ªå®šä¹‰æ£€æµ‹ç­–ç•¥

```java
public class CustomSecurityPolicy {
    
    // ç­–ç•¥1ï¼šæ¸¸æˆä¸“ç”¨
    public static boolean checkForGame(Context context) {
        SecurityDetector detector = new SecurityDetector(context, null);
        detector.performSecurityCheck();
        
        Map<String, DetectionResult> results = detector.getResults();
        
        // æ¸¸æˆä¸¥æ ¼ç¦æ­¢ï¼šRootã€Hookã€å†…å­˜ä¿®æ”¹
        return !results.get("ROOT").detected
            && !results.get("HOOK").detected
            && !results.get("MEMORY_HACK").detected;
    }
    
    // ç­–ç•¥2ï¼šé‡‘èåº”ç”¨ä¸“ç”¨
    public static boolean checkForFinance(Context context) {
        SecurityDetector detector = new SecurityDetector(context, null);
        detector.performSecurityCheck();
        
        // é‡‘èåº”ç”¨è¦æ±‚æœ€é«˜å®‰å…¨çº§åˆ«
        return detector.getSecurityScore() >= 90;
    }
    
    // ç­–ç•¥3ï¼šè‡ªå®šä¹‰æƒé‡
    public static int getCustomScore(Context context) {
        SecurityDetector detector = new SecurityDetector(context, null);
        detector.performSecurityCheck();
        
        Map<String, DetectionResult> results = detector.getResults();
        
        int score = 100;
        
        // è‡ªå®šä¹‰æƒé‡
        if (results.get("ROOT").detected) score -= 40;
        if (results.get("HOOK").detected) score -= 40;
        if (results.get("EMULATOR").detected) score -= 10;
        if (results.get("DEBUGGER").detected) score -= 20;
        
        return Math.max(0, score);
    }
}
```

---

## æ€»ç»“

### ä¼˜åŠ¿

1. âœ… **å…¨é¢æ€§** - è¦†ç›–10ç§å¸¸è§å¨èƒ
2. âœ… **å‡†ç¡®æ€§** - å¤šç§æ£€æµ‹æ–¹æ³•äº¤å‰éªŒè¯
3. âœ… **æ€§èƒ½** - å¼‚æ­¥æ‰§è¡Œï¼Œä¸å½±å“ä½“éªŒ
4. âœ… **çµæ´»æ€§** - åˆ†çº§å¤„ç†ï¼Œå¯è‡ªå®šä¹‰ç­–ç•¥
5. âœ… **å¯æ‰©å±•** - æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°æ£€æµ‹

### å±€é™æ€§

1. âš ï¸ å®¢æˆ·ç«¯æ£€æµ‹éƒ½å¯èƒ½è¢«ç»•è¿‡
2. âš ï¸ æŸäº›æ£€æµ‹å¯èƒ½æœ‰è¯¯æŠ¥
3. âš ï¸ éœ€è¦é…åˆæœåŠ¡å™¨ç«¯éªŒè¯
4. âš ï¸ å¯¹æŠ—æ€§æ£€æµ‹ä¼šä¸æ–­å‡çº§

### å»ºè®®

1. ğŸ” é…åˆä»£ç æ··æ·†å’ŒåŠ å›º
2. ğŸ” é‡è¦æ“ä½œå¿…é¡»æœåŠ¡å™¨éªŒè¯
3. ğŸ” å®šæœŸæ›´æ–°æ£€æµ‹è§„åˆ™
4. ğŸ” ç›‘æ§å¼‚å¸¸è¡Œä¸ºæ¨¡å¼
5. ğŸ” ç»“åˆé£æ§ç³»ç»Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬:** 1.0.0  
**æœ€åæ›´æ–°:** 2025-10-23


