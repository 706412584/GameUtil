# åä½œå¼Šæ¨¡å— - å¿«é€Ÿå¼€å§‹

## 5åˆ†é’Ÿé›†æˆæŒ‡å—

### æ­¥éª¤1ï¼šæ·»åŠ ä¾èµ– (30ç§’)

åœ¨ `settings.gradle` ç¡®è®¤åŒ…å«ï¼š
```gradle
include ':AntiCheat'
```

åœ¨åº”ç”¨æ¨¡å—çš„ `build.gradle` æ·»åŠ ï¼š
```gradle
dependencies {
    implementation project(':AntiCheat')
}
```

### æ­¥éª¤2ï¼šåŸºç¡€ä½¿ç”¨ (2åˆ†é’Ÿ)

**æœ€ç®€å•çš„ç”¨æ³•ï¼š**

```java
import game.app.anticheat.SecurityDetector;

public class MainActivity extends Activity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        // åˆ›å»ºæ£€æµ‹å™¨
        SecurityDetector detector = new SecurityDetector(this, 
            new SecurityDetector.SecurityCallback() {
            
            @Override
            public void onThreatDetected(String type, String desc, int level) {
                // æ£€æµ‹åˆ°å¨èƒ
                Log.w("Security", type + ": " + desc);
            }
            
            @Override
            public void onDetectionComplete(boolean passed, 
                                           List<DetectionResult> threats) {
                // æ£€æµ‹å®Œæˆ
                if (passed) {
                    // å®‰å…¨ï¼Œç»§ç»­
                    startApp();
                } else {
                    // æœ‰é£é™©
                    handleThreats(threats);
                }
            }
        });
        
        // æ‰§è¡Œæ£€æµ‹
        detector.performSecurityCheck();
    }
}
```

### æ­¥éª¤3ï¼šå¤„ç†ç»“æœ (2åˆ†é’Ÿ)

**æ ¹æ®å®‰å…¨åˆ†æ•°å¤„ç†ï¼š**

```java
private void handleSecurityResult(boolean passed, 
                                  List<DetectionResult> threats) {
    // è·å–å®‰å…¨åˆ†æ•° (0-100)
    int score = securityDetector.getSecurityScore();
    
    if (score >= 80) {
        // é«˜åˆ†ï¼šæ­£å¸¸è¿è¡Œ
        Toast.makeText(this, "å®‰å…¨æ£€æµ‹é€šè¿‡", Toast.LENGTH_SHORT).show();
        
    } else if (score >= 60) {
        // ä¸­ç­‰ï¼šè­¦å‘Š
        showWarning("æ£€æµ‹åˆ°å®‰å…¨é£é™©ï¼Œè¯·æ³¨æ„");
        
    } else {
        // ä½åˆ†ï¼šæ‹’ç»è¿è¡Œ
        showError("å®‰å…¨æ£€æµ‹å¤±è´¥ï¼Œåº”ç”¨å°†é€€å‡º");
        finish();
    }
}
```

## å¸¸ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ¸¸æˆåº”ç”¨å¯åŠ¨æ£€æµ‹

```java
public class GameActivity extends Activity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        
        SecurityDetector detector = new SecurityDetector(this, callback);
        detector.performSecurityCheck();
    }
    
    private SecurityDetector.SecurityCallback callback = 
        new SecurityDetector.SecurityCallback() {
        
        @Override
        public void onThreatDetected(String type, String desc, int level) {
            if (level >= 5) {
                // ä¸¥é‡å¨èƒï¼šRootã€Hookã€å†…å­˜ä¿®æ”¹å™¨
                // ç«‹å³é€€å‡º
                finish();
                System.exit(0);
            }
        }
        
        @Override
        public void onDetectionComplete(boolean passed, 
                                       List<DetectionResult> threats) {
            if (passed || getSecurityScore() >= 70) {
                startGame();
            } else {
                showSecurityError();
            }
        }
    };
}
```

### åœºæ™¯2ï¼šä»…æ£€æµ‹Root

```java
import game.app.anticheat.RootDetector;

RootDetector rootDetector = new RootDetector(context);
if (rootDetector.isDeviceRooted()) {
    Toast.makeText(context, "æ£€æµ‹åˆ°Rootè®¾å¤‡", Toast.LENGTH_SHORT).show();
    // å¤„ç†Rootè®¾å¤‡
}
```

### åœºæ™¯3ï¼šä»…æ£€æµ‹æ¨¡æ‹Ÿå™¨

```java
import game.app.anticheat.EmulatorDetector;

EmulatorDetector emulatorDetector = new EmulatorDetector(context);
if (emulatorDetector.isEmulator()) {
    Toast.makeText(context, "æ£€æµ‹åˆ°æ¨¡æ‹Ÿå™¨", Toast.LENGTH_SHORT).show();
    // å¤„ç†æ¨¡æ‹Ÿå™¨
}
```

### åœºæ™¯4ï¼šç­¾åéªŒè¯

```java
import game.app.anticheat.SignatureValidator;

SignatureValidator validator = new SignatureValidator(context);

// 1. å¼€å‘é˜¶æ®µï¼šè·å–ç­¾å
String signature = validator.getCurrentSignatureSHA256();
Log.i("Signature", "åº”ç”¨ç­¾å: " + signature);
// å¤åˆ¶è¿™ä¸ªç­¾åå€¼ï¼Œç”¨äºæ­£å¼ç‰ˆæœ¬

// 2. æ­£å¼ç‰ˆæœ¬ï¼šéªŒè¯ç­¾å
validator.setExpectedSignature("YOUR_RELEASE_SIGNATURE_SHA256_HERE");
if (!validator.verifySignature()) {
    // ç­¾åè¢«ç¯¡æ”¹ï¼Œåº”ç”¨è¢«é‡æ–°æ‰“åŒ…
    Toast.makeText(context, "åº”ç”¨ç­¾åå¼‚å¸¸", Toast.LENGTH_SHORT).show();
    finish();
}
```

### åœºæ™¯5ï¼šå®šæœŸæ£€æµ‹

```java
// æ¯5åˆ†é’Ÿæ£€æµ‹ä¸€æ¬¡
Handler handler = new Handler(Looper.getMainLooper());
Runnable checkTask = new Runnable() {
    @Override
    public void run() {
        performSecurityCheck();
        handler.postDelayed(this, 5 * 60 * 1000);
    }
};
handler.post(checkTask);

private void performSecurityCheck() {
    new Thread(() -> {
        SecurityDetector detector = new SecurityDetector(context, callback);
        detector.performSecurityCheck();
    }).start();
}
```

## é«˜çº§åŠŸèƒ½

### æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š

```java
// ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
String report = securityDetector.generateSecurityReport();
System.out.println(report);

// è¾“å‡ºç¤ºä¾‹ï¼š
// === å®‰å…¨æ£€æµ‹æŠ¥å‘Š ===
//
// å®‰å…¨åˆ†æ•°: 85/100
//
// æ£€æµ‹é¡¹ç›®:
// - ROOT: âœ… é€šè¿‡
// - EMULATOR: âœ… é€šè¿‡
// - HOOK: âœ… é€šè¿‡
// - DEBUGGER: âŒ æ£€æµ‹åˆ°
//   é£é™©ç­‰çº§: 4/5
//   è¯¦æƒ…: ADBè°ƒè¯•å·²å¯ç”¨
// ...
```

### è·å–æ‰€æœ‰æ£€æµ‹ç»“æœ

```java
Map<String, DetectionResult> results = securityDetector.getResults();

for (Map.Entry<String, DetectionResult> entry : results.entrySet()) {
    DetectionResult result = entry.getValue();
    
    System.out.println("ç±»å‹: " + result.type);
    System.out.println("æ£€æµ‹åˆ°: " + result.detected);
    System.out.println("é£é™©ç­‰çº§: " + result.riskLevel);
    System.out.println("è¯¦æƒ…: " + result.details);
}
```

## é£é™©ç­‰çº§è¯´æ˜

| ç­‰çº§ | å¨èƒç±»å‹ | å»ºè®®å¤„ç† |
|-----|---------|---------|
| 5 | Rootã€Hookã€å†…å­˜ä¿®æ”¹ã€ç­¾åå¼‚å¸¸ | **ç«‹å³é€€å‡º** |
| 4 | å¤šå¼€ã€è°ƒè¯•å™¨ | è­¦å‘Šå¹¶é™åˆ¶åŠŸèƒ½ |
| 3 | æ¨¡æ‹Ÿå™¨ã€æ—¶é—´ä½œå¼Š | è®°å½•æ—¥å¿— |
| 2 | ä»£ç† | ä»…è®°å½• |

## æ³¨æ„äº‹é¡¹

### âœ… æ¨èåšæ³•

1. **åº”ç”¨å¯åŠ¨æ—¶æ£€æµ‹**
   ```java
   // åœ¨MainActivityçš„onCreateä¸­æ‰§è¡Œ
   securityDetector.performSecurityCheck();
   ```

2. **å®šæœŸåå°æ£€æµ‹**
   ```java
   // æ¯éš”å‡ åˆ†é’Ÿæ£€æµ‹ä¸€æ¬¡
   handler.postDelayed(checkTask, 5 * 60 * 1000);
   ```

3. **å…³é”®æ“ä½œå‰æ£€æµ‹**
   ```java
   // æ”¯ä»˜ã€äº¤æ˜“ç­‰æ“ä½œå‰æ£€æµ‹
   if (securityDetector.getSecurityScore() < 80) {
       // æ‹’ç»æ“ä½œ
   }
   ```

4. **ä¸ŠæŠ¥æœåŠ¡å™¨**
   ```java
   // å°†æ£€æµ‹ç»“æœä¸ŠæŠ¥åˆ°æœåŠ¡å™¨
   String report = securityDetector.generateSecurityReport();
   uploadToServer(report);
   ```

### âŒ æ³¨æ„é¿å…

1. **ä¸è¦åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ**
   ```java
   // âŒ é”™è¯¯ï¼šä¼šé˜»å¡UI
   // securityDetector.performSecurityCheck(); // åœ¨ä¸»çº¿ç¨‹
   
   // âœ… æ­£ç¡®ï¼šå·²ç»æ˜¯å¼‚æ­¥çš„ï¼Œç›´æ¥è°ƒç”¨å³å¯
   securityDetector.performSecurityCheck();
   ```

2. **ä¸è¦è¿‡äºé¢‘ç¹æ£€æµ‹**
   ```java
   // âŒ é”™è¯¯ï¼šæ¯ç§’æ£€æµ‹
   handler.postDelayed(checkTask, 1000);
   
   // âœ… æ­£ç¡®ï¼š5-10åˆ†é’Ÿæ£€æµ‹ä¸€æ¬¡
   handler.postDelayed(checkTask, 5 * 60 * 1000);
   ```

3. **ä¸è¦å¿½ç•¥æ‰€æœ‰å¨èƒ**
   ```java
   // âŒ é”™è¯¯ï¼šæ£€æµ‹åˆ°Rootä½†ä¸å¤„ç†
   if (rootDetector.isDeviceRooted()) {
       // ä»€ä¹ˆéƒ½ä¸åš
   }
   
   // âœ… æ­£ç¡®ï¼šè‡³å°‘è®°å½•æ—¥å¿—
   if (rootDetector.isDeviceRooted()) {
       Log.w("Security", "æ£€æµ‹åˆ°Rootè®¾å¤‡");
       reportToServer("ROOT");
   }
   ```

## è·å–å¸®åŠ©

- ğŸ“– [å®Œæ•´æ–‡æ¡£](ä½¿ç”¨æŒ‡å—.md)
- ğŸ“– [æ¶æ„è®¾è®¡](æ¶æ„è®¾è®¡.md)
- ğŸ’» [ç¤ºä¾‹ä»£ç ](src/main/java/game/app/anticheat/AntiCheatExample.java)
- ğŸ”§ [é›†æˆç¤ºä¾‹](../app/src/main/java/com/example/IntegratedSecurityExample.java)

## ä¸‹ä¸€æ­¥

1. é˜…è¯» [ä½¿ç”¨æŒ‡å—.md](ä½¿ç”¨æŒ‡å—.md) äº†è§£è¯¦ç»†åŠŸèƒ½
2. æŸ¥çœ‹ [æ¶æ„è®¾è®¡.md](æ¶æ„è®¾è®¡.md) äº†è§£å®ç°åŸç†
3. å‚è€ƒ [AntiCheatExample.java](src/main/java/game/app/anticheat/AntiCheatExample.java) å­¦ä¹ é«˜çº§ç”¨æ³•

---

å¼€å§‹ä½¿ç”¨ï¼Œ5åˆ†é’Ÿä¿æŠ¤ä½ çš„åº”ç”¨ï¼ ğŸ”

